{
    "collab_server" : "",
    "contents" : "---\ntitle: \"SDM4 in R: Multiple Regression Wisdom (Chapter 29)\"\nauthor: \"Nicholas Horton (nhorton@amherst.edu)\"\ndate: \"April 9, 2016\"\noutput: \n  pdf_document:\n    fig_height: 2.8\n    fig_width: 7\n  html_document:\n    fig_height: 3\n    fig_width: 5\n  word_document:\n    fig_height: 4\n    fig_width: 6\n---\n\n\n```{r, include=FALSE}\n# Don't delete this chunk if you are using the mosaic package\n# This loads the mosaic and dplyr packages\nrequire(mosaic)\noptions(digits=4)\n```\n\n```{r, include=FALSE}\n# Some customization.  You can alter or delete as desired (if you know what you are doing).\n\n# This changes the default colors in lattice plots.\ntrellis.par.set(theme=theme.mosaic())  \n\n# knitr settings to control how R chunks work.\nrequire(knitr)\nopts_chunk$set(\n  tidy=FALSE,     # display code as typed\n  size=\"small\"    # slightly smaller font for code\n)\n```\n\n## Introduction and background \n\nThis document is intended to help describe how to undertake analyses introduced \nas examples in the Fourth Edition of \\emph{Stats: Data and Models} (2014) by De Veaux, Velleman, and Bock.\nMore information about the book can be found at http://wps.aw.com/aw_deveaux_stats_series.  This\nfile as well as the associated R Markdown reproducible analysis source file used to create it can be found at http://www.amherst.edu/~nhorton/sdm4.\n\nThis work leverages initiatives undertaken by Project MOSAIC (http://www.mosaic-web.org), an NSF-funded effort to improve the teaching of statistics, calculus, science and computing in the undergraduate curriculum. In particular, we utilize the `mosaic` package, which was written to simplify the use of R for introductory statistics courses. A short summary of the R needed to teach introductory statistics can be found in the mosaic package vignettes (http://cran.r-project.org/web/packages/mosaic).\n\n## Chapter 29: Multiple Regression Wisdom\n\n\n```{r}\nlibrary(mosaic); library(readr)\nCoasters <- read_csv(\"http://www.amherst.edu/~nhorton/sdm4/data/Roller_coasters_2014.csv\")\n# Name,Park,Track,Speed,Height,Drop,Length,Duration,Inversions,Opened\nglimpse(Coasters)\ntally(~ Speed, data=Coasters)\nfilter(Coasters, Speed==\"*100\" | Speed==\"*56\")\n```\nNote that two of the observations for speed have special characters in them.\nWe first need to address these data irregularities:\n```{r}\nlibrary(tidyr)\nCoasters <- mutate(Coasters, Speed = extract_numeric(Speed))\n```\nTo match the output we need to remove these two coasters.\n\n```{r}\ndim(Coasters)\nCoasters <- filter(Coasters, \n  !(Name %in% c(\"Tower of Terror\", \"Wild Beast\")))\ndim(Coasters)\n```\n\n\nFigure 29.1 (page 860) displays the scatterplot of duration as a function\nof speed.\n\n```{r}\nxyplot(Duration ~ Speed, type=c(\"p\", \"r\"), xlab=\"Speed (mph)\",\n  ylab=\"Duration (sec)\", data=Coasters)\n```\n\nWe can also replicate the regression model (and regression diagnostics)\non the bottom of page 860.\n\n```{r}\nmod1 <- lm(Duration ~ Speed, data=Coasters)\nmsummary(mod1)\nxyplot(resid(mod1) ~ fitted(mod1), xlab=\"Predicted (sec)\",\n  ylab=\"Residuals (sec)\", type=c(\"p\", \"r\"))\n```\n\n### Section 29.1: Indicators\n\nThe model displayed on the bottom of page 861 is restricted to \nroller coasters with no inversions.\n```{r}\nnoinversion <- filter(Coasters, Inversions==0)  # 0 is No (or FALSE)\nmod2 <- lm(Duration ~ Speed, data=noinversion)\nmsummary(mod2)\n```\n\nWe can do the same for coasters with inversions:\n```{r}\nmod3 <- lm(Duration ~ Speed, data=filter(Coasters, Inversions==1))\nmsummary(mod3)\n```\n\nThe model at the top of page 862 adds the Inversion indicator to the\nmodel.\n\n```{r}\nmod4 <- lm(Duration ~ Speed + Inversions, data=Coasters)\nmsummary(mod4)\nmod4fun <- makeFun(mod4)\n```\n\nWe can generate predicted values from this model.\n```{r}\nmod4fun(Speed=55, Inversions=0)  # Hayabusa\nmod4fun(Speed=60.3, Inversions=1)  # Hangman\n```\n\nOn page 864 the Burger King example is introduced with a subset of items from\nthe menu.\n```{r}\nBK <- read.csv(\"http://www.amherst.edu/~nhorton/sdm4/data/BK_items.csv\", \n               stringsAsFactors = FALSE)\nBKmod <- lm(Calories ~ Carbs.g. + Meat. + Carbs.g.*Meat., data=BK)\nmsummary(BKmod)\n```\nThe same predicted values can be calculated using this model.\n\n```{r}\nBKfun <- makeFun(BKmod)\nBKfun(Carbs.g=53, Meat=\"Y\")\nBKfun(Carbs.g=43, Meat=\"N\")\n```\n\n### Section 29.2: Diagnosing multiple regression models\n\n```{r}\nBK <- mutate(BK, resid = resid(BKmod), fitted=fitted(BKmod),\n             student=rstudent(BKmod), CooksD=cooks.distance(BKmod))\nmplot(BKmod, which=1)\nmplot(BKmod, which=2)\nmplot(BKmod, which=3)\nmplot(BKmod, which=4)\nfavstats(~ CooksD, data=BK)\nBK[11,]   # or filter(BK, Carbs.g. > 0.486)\nmplot(BKmod, which=5)\nmplot(BKmod, which=6)\n```\n",
    "created" : 1466792232064.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "419279936",
    "id" : "4ACD7C71",
    "lastKnownWriteTime" : 1466108146,
    "last_content_update" : 1466108146,
    "path" : "~/SDM4inR/Chapter29.Rmd",
    "project_path" : "Chapter29.Rmd",
    "properties" : {
    },
    "relative_order" : 2,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_markdown"
}